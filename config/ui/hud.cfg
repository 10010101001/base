defvarp showfps 0 0 2
defvarp showstats 0 0 2
defvarp showvelocity 0 1 1
defvarp showtimestyle 0 3 4
defvarp showconsole 0 1 1

defvar fullconsole 0 0 1
toggleconsole = [fullconsole (! $fullconsole)]

defvarp conintime 0 500 $varidxmax
defvarp conouttime 0 7500 $varidxmax
defvarp confadetime 0 1000 $varidxmax
defvarp conlines 0 4 $varidxmax
defvarp conlinesopen 0 7 $varidxmax
deffvarp conblend 0 0.75 1
defvarp chatintime 0 500 $varidxmax
defvarp chatouttime 0 10000 $varidxmax
defvarp chatfadetime 0 1000 $varidxmax
defvarp chatlines 0 4 $varidxmax
deffvarp chatblend 0 0.75 1

defvarp showminimap 0 1 1
deffvarp minimapdist 0 300 $fvaridxmax
deffvarp minimapdistblend 0 500 $fvaridxmax
deffvarp minimapoffset 0 0.075 1
deffvarp minimapborder 0 0.1 1
deffvarp minimapblipsize 0 0.008 1
deffvarp minimapsmallblipsize 0 0.0055 1
defvarp minimapplayernames 0 0 1

defvarp showradar 0 1 1
deffvarp radardist 0 300 $fvaridxmax
deffvarp radardistblend 0 500 $fvaridxmax
deffvarp radaroffset 0 0.235 1
deffvarp radarblipsize 0 0.015 1
deffvarp radarsmallblipsize 0 0.009 1
defvarp radarplayernames 0 0 1
deffvarp radarsizew 0 0.5 2
deffvarp radarsizeh 0 0.5 2

ui_hud_sizew    = 0.075
ui_hud_sizeh    = 0.15
ui_hud_bar      = 0.14
ui_hud_barw     = 0.05
ui_hud_barh     = 0.1
ui_hud_bar2     = 0.025
ui_hud_top      = 0.03
ui_hud_mtrw     = 0.06
ui_hud_mtrh     = 0.03

ui_hud_connames = [Debug Event Frag Chat]
ui_hud_concols = [red orange yellow green]

ui_hud_init = [
    refreshenginestats
    ui_hud_clientnum = (getplayercn)
    ui_hud_focus = (getclientfocused)
    ui_hud_actor = (getclientactortype $ui_hud_focus)
    ui_hud_state = (getclientstate $ui_hud_focus)
    ui_hud_team = (getclientteam $ui_hud_focus)
    ui_hud_carryaffinity = (getclientcarryaffinity $ui_hud_focus)
    ui_hud_colour = (? $ui_hud_carryaffinity (getclientrescolour $ui_hud_focus $pulseidxdisco (getteamcolour $ui_hud_team)) (getteamcolour $ui_hud_team))
    ui_hud_colour1 = (| $ui_transor (modcolour $ui_hud_colour 0.5))
    ui_hud_colour2 = (| $ui_transor (modcolour $ui_hud_colour 0.1))
    ui_hud_colour3 = (| $ui_transor (modcolour $ui_hud_colour 0.8))
    ui_hud_colourw = (| $ui_transor $colourwhite)
    ui_hud_commandmillis = (getcommandmillis)
    ui_hud_commandopen = (> $ui_hud_commandmillis 0)
    ui_hud_showhud = (&& (=s (getprogresstitle) "") (|| $ui_hud_commandopen $showhud))
]

// 1:console 2:count 3:outtime 4:fadetime 5:intime 6:blend 7:size
ui_hud_displayconsole = [
    loopconlinesrev $arg1 $arg2 0 ui_hud_consoleline [
        ui_hud_consoleblend = (ceil (*f 255 $arg6))
        ui_hud_consoletime = (getconlinereftime $arg1 $ui_hud_consoleline)
        ui_hud_consolemillis = (- (getmillis 1) $ui_hud_consoletime)
        ui_hud_consolegrowth = 1.0
        caseif (&& $arg3 (> $ui_hud_consolemillis $arg3)) [
            ui_hud_consolectime = (- $ui_hud_consolemillis $arg3)
            if (&& $arg4 (< $ui_hud_consolectime $arg4)) [
                ui_hud_consolegrowth = (-f 1 (divf $ui_hud_consolectime $arg4))
                ui_hud_consoleblend = (clamp (*f $ui_hud_consolegrowth $arg6 255) 0 255)
            ] [ui_hud_consoleblend = 0]
        ] (&& $arg5 (< $ui_hud_consolemillis $arg5)) [
            ui_hud_consolegrowth = (divf $ui_hud_consolemillis $arg5)
            ui_hud_consoleblend = (clamp (*f $ui_hud_consolegrowth $arg6 255) 0 255)
            ui_hud_consolegrowth = (-f $ui_hud_consolegrowth)
        ]
        if $ui_hud_consoleblend [
            uitext (getconlinecref $arg1 $ui_hud_consoleline) $ui_text [
                uitextcolour (| (<< $ui_hud_consoleblend 24) $colourwhite)
                uitextwrap $arg7
                uitextalign -1
                uialign -1 1
                if (<f $ui_hud_consolegrowth 1) [uitextgrowth $ui_hud_consolegrowth]
            ]
        ]
    ]
]

ui_hud_showconsole = [
    uivlist 0 [
        uialign -1 -1
        if $ui_hud_commandopen [
            uihudskin 1 0 $ui_hud_colour1 $ui_hud_colour2 [
                uialign -1 -1
                uispace $ui_padsmall $ui_padsmall [
                    uiclamp 1 1
                    uialign -1 -1
                    uivlist 0 [
                        uiclamp 1 1
                        uialign -1 -1
                        loop i 4 [
                            if (getconlines $i) [
                                uihudskin 0 0 $ui_hud_colour2 $ui_hud_colour1 [
                                    uiclamp 1 1
                                    uialign -1 -1
                                    uispace $ui_padsmall $ui_padtiny [
                                        uiclamp 1 1
                                        uialign -1 -1
                                        uitext (concat (at $ui_hud_connames $i) "Console") $ui_textbig [
                                            uitextwrap 0.95
                                            uitextcolour $[colour@(at $ui_hud_concols $i)]
                                            uitextalign -1
                                            uialign -1 1
                                        ]
                                    ]
                                ] [uiclamp 1 1]
                                uihudskin 0 0 $ui_hud_colour2 $ui_hud_colour1 [
                                    uiclamp 1 1
                                    uialign -1 -1
                                    uispace $ui_padnormal $ui_padsmall [
                                        uiclamp 1 1
                                        uialign -1 -1
                                        uivlist 0 [
                                            uialign -1 -1
                                            ui_hud_displayconsole $i (- $conlinesopen) 0 0 0 1 0.95
                                        ]
                                    ]
                                ] [uiclamp 1 1]
                            ]
                        ]
                        uispace 0 $ui_padsmall
                        uihudskin 0 0 $ui_hud_colour2 $colourred [
                            uiclamp 1 1
                            uialign -1 -1
                            uihlist 0 [
                                uialign -1 -1
                                ui_hud_commandicon = (getcommandicon)
                                if (=s $ui_hud_commandicon "") [ui_hud_commandicon = $inputtex]
                                uispace $ui_padsmall $ui_padsmall [uialign -1 -1; uiimage $ui_hud_commandicon (getclientrescolour $ui_hud_focus $pulseidxbuff (getcommandcolour)) 0 0.0225 0.0225]
                                uitext (getcommandbuf) $ui_textlarge [uitextwrap 0.95; uitextpos (getcommandpos); uitextalign -1; uialign -1 1]
                            ]
                        ] [uiclamp 1 1; uialign -1 -1]
                    ]
                ]
            ] [uialign -1 -1]
        ] [
            loop i (? (isconnected) 2 3) [
                ui_hud_displayconsole (+ $i 1) (- $conlines) (? $fullconsole 0 $conouttime) (? $fullconsole 0 $confadetime) (? $fullconsole 0 $conintime) (? $fullconsole 1 $conblend) 1
            ]
        ]
    ]
]

ui_hud_chatconsole = [
    uispace $ui_padsmall $ui_padtiny [
        uialign -1 1
        uivlist 0 [
            uialign -1 1
            ui_hud_displayconsole 3 (- $chatlines) (? $fullconsole 0 $chatouttime) (? $fullconsole 0 $chatfadetime) $chatintime (? $fullconsole 1 $chatblend) 0.6
        ]
    ]
]

ui_hud_residuals = [
    if (getclientshocking $ui_hud_focus) [
        uihudskin $ui_hud_sizew 0 $ui_hud_colour1 $ui_hud_colour2 [
            uispace $ui_padtiny $ui_padtiny [
                uitext "SHOCK" $ui_textsmall [uitextlimit 1; uitextcolour (getclientrescolour $ui_hud_focus $pulseidxshock)]
            ]
        ]
        uispace 0 $ui_padtiny
    ]
    if (getclientbleeding $ui_hud_focus) [
        uihudskin $ui_hud_sizew 0 $ui_hud_colour1 $ui_hud_colour2 [
            uispace $ui_padtiny $ui_padtiny [
                uitext "BLEED" $ui_textsmall [uitextlimit 1; uitextcolour (getclientrescolour $ui_hud_focus $pulseidxbleed)]
            ]
        ]
        uispace 0 $ui_padtiny
    ]
    if (getclientburning $ui_hud_focus) [
        uihudskin $ui_hud_sizew 0 $ui_hud_colour1 $ui_hud_colour2 [
            uispace $ui_padtiny $ui_padtiny [
                uitext "BURN" $ui_textsmall [uitextlimit 1; uitextcolour (getclientrescolour $ui_hud_focus $pulseidxburn)]
            ]
        ]
        uispace 0 $ui_padtiny
    ]
    if (getclientbuffing $ui_hud_focus) [
        uihudskin $ui_hud_sizew 0 $ui_hud_colour1 $ui_hud_colour2 [
            uispace $ui_padtiny $ui_padtiny [
                uitext "BUFF" $ui_textsmall [uitextlimit 1; uitextcolour (getclientrescolour $ui_hud_focus $pulseidxbuff)]
            ]
        ]
        uispace 0 $ui_padtiny
    ]
]

ui_hud_healthbar = [
    uihudskin $ui_hud_sizew (? $ui_hud_state $ui_hud_sizew $ui_hud_bar) $ui_hud_colour1 $ui_hud_colour2 [
        uivlist 0 [
            uialign 0 1
            ui_hud_health = (getclienthealth $ui_hud_focus)
            ui_hud_spawnhealth = (getspawnhealth $ui_hud_actor)
            ui_hud_regen = (getclientregen $ui_hud_focus)
            ui_hud_healthpart = 1.0
            ui_hud_healthclip = 0
            ui_hud_healthpart = (divf $ui_hud_health $ui_hud_spawnhealth)
            if (<f $ui_hud_healthpart 1.0) [
                ui_hud_healthclip = (*f $ui_hud_barh (clampf $ui_hud_healthpart 0.0 1.0))
            ]
            if (>f $ui_hud_healthpart 0) [
                uiclip 0 $ui_hud_healthclip 0 (-f $ui_hud_barh $ui_hud_healthclip) [
                    uialign 0 1
                    uiimagevgradient "<grey>textures/barskin" $colourgreen $colouryellow 0 $ui_hud_barw $ui_hud_barh [
                        uialign 0 1
                        uicolouradd $colourred
                        if $ui_hud_regen [
                            ui_hud_regenlast = (- (getmillis) $ui_hud_regen)
                            if (<= $ui_hud_regenlast $regentime) [
                                uicolourrotate (divf $ui_hud_regenlast $regentime)
                            ]
                        ]
                    ]
                ]
            ] [uifill $ui_hud_barw $ui_hud_barh]
            caseif (>f $ui_hud_healthpart 1.0) [
                uitext $ui_hud_health $ui_textlarge [uitextlimit 1; uitextcolour (getclientrescolour $ui_hud_focus $pulseidxbuff); uialign 0 1]
            ] (<=f $ui_hud_healthpart 0.25) [
                uitext $ui_hud_health $ui_textlarge [uitextlimit 1; uitextcolour (getclientrescolour $ui_hud_focus $pulseidxwarn); uialign 0 1]
            ] () [uitext $ui_hud_health $ui_textlarge [uitextlimit 1; uialign 0 1]]
        ]
    ]
]

ui_hud_leftbar = [
    if (= $ui_hud_state 0) [ui_hud_residuals; ui_hud_healthbar]
]

ui_hud_captureinventory = [
    loopcapture 0 0 ui_hud_flag [
        ui_hud_flagteam = (getcaptureteam $ui_hud_flag)
        ui_hud_flagname = (at $teamnames $ui_hud_flagteam)
        ui_hud_flagcol = $[team@[ui_hud_flagname]colour]
        ui_hud_flagcol1 = (modcolour $ui_hud_flagcol 0.75)
        //ui_hud_flagcol2 = (modcolour $ui_hud_flagcol 0.5)
        ui_hud_flagdrop = (getcapturedroptime $ui_hud_flag)
        ui_hud_flagtake = (getcapturetaketime $ui_hud_flag)
        ui_hud_flagowner = (getcaptureowner $ui_hud_flag)
        //ui_hud_flaglast = (getcapturelastowner $ui_hud_flag)
        ui_hud_flagclip = $ui_hud_mtrw
        ui_hud_flagpart = 0.0
        if $ui_hud_flagdrop [
            ui_hud_flagoffs = (- (getmillis) $ui_hud_flagdrop)
            ui_hud_flagpart = (-f 1 (divf $ui_hud_flagoffs (getcapturedelay)))
            if (<f $ui_hud_flagpart 1.0) [ui_hud_flagclip = (*f $ui_hud_mtrw (clampf $ui_hud_flagpart 0.0 1.0))]
        ]
        uivlist 0 [
            uihudskin $ui_hud_sizew $ui_hud_top (? (= $ui_hud_flagowner $ui_hud_focus) $ui_hud_colour3 $ui_hud_colour1) $ui_hud_colour2 [
                caseif (>= $ui_hud_flagowner 0) [
                   uispace $ui_padsmall $ui_padsmall [uitext (getclientname $ui_hud_flagowner 2 0) $ui_text [uitextlimit 1; uialign 0 0]]
                ] (>f $ui_hud_flagpart 0) [
                    uifill $ui_hud_mtrw $ui_hud_mtrh [
                        uialign 0 0
                        uiclip $ui_hud_flagclip 0 0 0 [
                            uialign -1 0
                            uiimagehgradient "<grey><rotate:1>textures/meterskin" $ui_hud_flagcol1 $ui_hud_flagcol 0 $ui_hud_mtrw $ui_hud_mtrh [
                                uialign -1 0
                                uicolouradd $colourwhite
                            ]
                        ]
                    ]
                ] () [
                   uispace $ui_padsmall $ui_padsmall [uitext (concatword "^f(" $[team@[ui_hud_flagname]tex] ")" $[team@[ui_hud_flagname]name]) $ui_textsmall [uitextlimit 1; uitextcolour $ui_hud_flagcol; uialign 0 0]]
                ]
            ]
            uispace 0 $ui_padtiny
            uihudskin $ui_hud_sizew $ui_hud_sizew (? (= $ui_hud_flagowner $ui_hud_focus) $ui_hud_colour3 $ui_hud_colour1) $ui_hud_colour2 [
                uivlist 0 [
                    uialign 0 -1
                    uiimage $flagtex $ui_hud_flagcol 0 $ui_hud_barw $ui_hud_barw [
                        uialign 0 0
                        caseif (>= $ui_hud_flagowner 0) [
                            ui_hud_flagownerteam = (getclientteam $ui_hud_flagowner)
                            ui_hud_flagownername = (at $teamnames $ui_hud_flagownerteam)
                            uiimage $flagtakentex $[team@[ui_hud_flagownername]colour] 0 $ui_hud_bar2 $ui_hud_bar2 [uialign -1 1]
                        ] (> $ui_hud_flagdrop 0) [
                            uiimage $flagdroptex $colourcyan 0 $ui_hud_bar2 $ui_hud_bar2 [uialign -1 1]
                        ] () [uiimage $pointtex $ui_hud_flagcol 0 $ui_hud_bar2 $ui_hud_bar2 [uialign -1 1]]
                    ]
                    caseif (>= $ui_hud_flagowner 0) [
                        caseif (= $ui_hud_flagowner $ui_hud_focus) [
                            uitext "HOLDING" $ui_textbig [uitextlimit 1; uitextcolour (getclientrescolour $ui_hud_focus $pulseidxwarn); uialign 0 1]
                        ] (= (getclientteam $ui_hud_flagowner) $ui_hud_team) [
                            uitext "RECLAIMED" $ui_textbig [uitextlimit 1; uitextcolour (getclientrescolour $ui_hud_focus $pulseidxbuff); uialign 0 1]
                        ] () [
                            uitext "STOLEN" $ui_textbig [uitextlimit 1; uitextcolour (getclientrescolour $ui_hud_focus $pulseidxwarn); uialign 0 1]
                        ]
                    ] (> $ui_hud_flagdrop 0) [
                        uitext "DROPPED" $ui_textbig [uitextlimit 1; uitextcolour (getclientrescolour $ui_hud_focus $pulseidxdisco); uialign 0 1]
                    ] () [uitext "SAFE" $ui_textbig [uitextlimit 1; uitextcolour $colourgreen; uialign 0 1]]
                ]
            ]
        ]
        uispace $ui_padtiny
    ]
]

ui_hud_defendinventory = [
    loopdefend 0 0 ui_hud_point [
        ui_hud_pointowner = (getdefendowner $ui_hud_point)
        ui_hud_pointname1 = (at $teamnames $ui_hud_pointowner)
        ui_hud_pointenemy = (getdefendenemy $ui_hud_point)
        ui_hud_pointname2 = (at $teamnames $ui_hud_pointenemy)
        ui_hud_pointname = (getdefendname $ui_hud_point)
        ui_hud_pointcol = $[team@[ui_hud_pointname1]colour]
        ui_hud_pointcol1 = (modcolour $ui_hud_pointcol 0.75)
        ui_hud_pointcol2 = (? (&& (= $ui_hud_pointowner $teamidxneutral) (!= $ui_hud_pointenemy $teamidxneutral)) $[team@[ui_hud_pointname2]colour] $[team@[ui_hud_pointname1]colour])
        ui_hud_pointcol3 = (modcolour $ui_hud_pointcol2 0.75)
        //ui_hud_pointcol2 = (modcolour $ui_hud_pointcol 0.5)
        //ui_hud_pointowners = (getdefendowners $ui_hud_point)
        //ui_hud_pointenemies = (getdefendenemies $ui_hud_point)
        //ui_hud_pointconverted = (getdefendconverted $ui_hud_point)
        ui_hud_pointoccupied = (getdefendoccupied $ui_hud_point)
        ui_hud_pointinside = (getdefendinside $ui_hud_point $ui_hud_focus 1)
        ui_hud_pointclip = $ui_hud_mtrw
        ui_hud_pointpart = 0.0
        if $ui_hud_pointenemy [
            ui_hud_pointpart = $ui_hud_pointoccupied
            if (<f $ui_hud_pointpart 1.0) [ui_hud_pointclip = (*f $ui_hud_mtrw (clampf $ui_hud_pointpart 0.0 1.0))]
        ]
        uivlist 0 [
            uihudskin $ui_hud_sizew $ui_hud_top (? $ui_hud_pointinside $ui_hud_colour3 $ui_hud_colour1) $ui_hud_colour2 [
                caseif (&& (>f $ui_hud_pointpart 0) (<f $ui_hud_pointpart 1)) [
                    uifill $ui_hud_mtrw $ui_hud_mtrh [
                        uialign 0 0
                        uiclip $ui_hud_pointclip 0 0 0 [
                            uialign -1 0
                            uiimagehgradient "<grey><rotate:1>textures/meterskin" $ui_hud_pointcol3 $ui_hud_pointcol2 0 $ui_hud_mtrw $ui_hud_mtrh [
                                uialign -1 0
                                uicolouradd $colourwhite
                            ]
                        ]
                    ]
                ] $ui_hud_pointowner [
                   uispace $ui_padsmall $ui_padsmall [uitext (concatword "^f(" $[team@[ui_hud_pointname1]tex] ")" $[team@[ui_hud_pointname1]name]) $ui_textsmall [uitextlimit 1; uitextcolour $ui_hud_pointcol; uialign 0 0]]
                ] () [
                   uispace $ui_padsmall $ui_padsmall [uitext (concatword "^f(" $pointtex ")" $[team@[ui_hud_pointname1]name]) $ui_textsmall [uitextlimit 1; uitextcolour $ui_hud_pointcol; uialign 0 0]]
                ]
            ]
            uispace 0 $ui_padtiny
            uihudskin $ui_hud_sizew $ui_hud_sizew (? $ui_hud_pointinside $ui_hud_colour3 $ui_hud_colour1) $ui_hud_colour2 [
                uivlist 0 [
                    uialign 0 -1
                    uiimage $pointtex $ui_hud_pointcol 0 $ui_hud_barw $ui_hud_barw [
                        uialign 0 0
                        caseif $ui_hud_pointenemy [
                            uiimage $attacktex $[team@[ui_hud_pointname2]colour] 0 $ui_hud_bar2 $ui_hud_bar2 [uialign -1 1]
                        ] $ui_hud_pointowner [
                            uiimage $[team@[ui_hud_pointname1]tex] $[team@[ui_hud_pointname1]colour] 0 $ui_hud_bar2 $ui_hud_bar2 [uialign -1 1]
                        ]
                        uispace 0 $ui_padtiny [
                            uialign 0 0
                            uitext $ui_hud_pointname $ui_textsmaller [uitextwrap 0.05; uitextcolour (| $ui_transor $colourwhite)]
                        ]
                    ]
                    caseif (|| $ui_hud_pointenemy $ui_hud_pointowner) [
                        caseif (&& $ui_hud_pointinside $ui_hud_pointenemy (= $ui_hud_pointenemy $ui_hud_team)) [
                            uitext "ATTACKING" $ui_textbig [uitextlimit 1; uitextcolour (getclientrescolour $ui_hud_focus $pulseidxwarn); uialign 0 1]
                        ] (<f $ui_hud_pointoccupied 1) [
                            uitext "SECURING" $ui_textbig [uitextlimit 1; uitextcolour (? (= $ui_hud_pointenemy $ui_hud_team) $colourgreen $colouryellow); uialign 0 1]
                        ] () [
                            uitext "SECURED" $ui_textbig [uitextlimit 1; uitextcolour (? (= $ui_hud_pointowner $ui_hud_team) $colourgreen $colourorange); uialign 0 1]
                        ]
                    ] () [uitext "OPEN" $ui_textbig [uitextlimit 1; uitextcolour $colourcyan; uialign 0 1]]
                ]
            ]
        ]
        uispace $ui_padtiny
    ]
]

ui_hud_bomberinventory = [
    loopbomber 0 0 ui_hud_bomb [
        if (&& (getbomberenabled $ui_hud_bomb) (= (getbomberteam $ui_hud_bomb) $teamidxneutral)) [
            //ui_hud_bombteam = (getbomberteam $ui_hud_bomb)
            ui_hud_bombcol = (getclientrescolour $ui_hud_focus $pulseidxdisco)
            ui_hud_bombcol1 = (modcolour $ui_hud_bombcol 0.75)
            //ui_hud_bombcol2 = (modcolour $ui_hud_bombcol 0.5)
            ui_hud_bombdrop = (getbomberdroptime $ui_hud_bomb)
            ui_hud_bombtake = (getbombertaketime $ui_hud_bomb)
            ui_hud_bombowner = (getbomberowner $ui_hud_bomb)
            //ui_hud_bomblast = (getbomberlastowner $ui_hud_bomb)
            //ui_hud_bombtarget = (getbombertarget $ui_hud_bomb)
            ui_hud_bombclip = $ui_hud_mtrw
            ui_hud_bombpart = 0.0
            caseif $ui_hud_bombdrop [
                ui_hud_bomboffs = (- (getmillis) $ui_hud_bombdrop)
                ui_hud_bombpart = (-f 1 (divf $ui_hud_bomboffs $bomberresetdelay))
                if (<f $ui_hud_bombpart 1.0) [ui_hud_bombclip = (*f $ui_hud_mtrw (clampf $ui_hud_bombpart 0.0 1.0))]
            ] $ui_hud_bombtake [
                ui_hud_bomboffs = (- (getmillis) $ui_hud_bombtake)
                ui_hud_bombpart = (-f 1 (divf $ui_hud_bomboffs $bombercarrytime))
                if (<f $ui_hud_bombpart 1.0) [ui_hud_bombclip = (*f $ui_hud_mtrw (clampf $ui_hud_bombpart 0.0 1.0))]
            ]
            uivlist 0 [
                uihudskin $ui_hud_sizew $ui_hud_top (? (= $ui_hud_bombowner $ui_hud_focus) $ui_hud_colour3 $ui_hud_colour1) $ui_hud_colour2 [
                    caseif (>f $ui_hud_bombpart 0) [
                        uifill $ui_hud_mtrw $ui_hud_mtrh [
                            uialign 0 0
                            uiclip $ui_hud_bombclip 0 0 0 [
                                uialign -1 0
                                uiimagehgradient "<grey><rotate:1>textures/meterskin" $ui_hud_bombcol1 $ui_hud_bombcol 0 $ui_hud_mtrw $ui_hud_mtrh [
                                    uialign -1 0
                                    uicolouradd $colourwhite
                                ]
                            ]
                        ]
                    ] (>= $ui_hud_bombowner 0) [
                       uispace $ui_padsmall $ui_padsmall [uitext (getclientname $ui_hud_bombowner 2 0) $ui_text [uitextlimit 1; uialign 0 0]]
                    ] () [
                        uispace $ui_padsmall $ui_padsmall [uitext "Bomb" $ui_text [uitextlimit 1; uitextcolour (getclientrescolour $ui_hud_focus $pulseidxdisco); uialign 0 0]]
                    ]
                ]
                uispace 0 $ui_padtiny
                uihudskin $ui_hud_sizew $ui_hud_sizew (? (= $ui_hud_bombowner $ui_hud_focus) $ui_hud_colour3 $ui_hud_colour1) $ui_hud_colour2 [
                    uivlist 0 [
                        uialign 0 -1
                        uiimage $bombtex $ui_hud_bombcol 0 $ui_hud_barw $ui_hud_barw [
                            uialign 0 0
                            caseif (>= $ui_hud_bombowner 0) [
                                ui_hud_bombownerteam = (getclientteam $ui_hud_bombowner)
                                ui_hud_bombownername = (at $teamnames $ui_hud_bombownerteam)
                                uiimage $bombtakentex $[team@[ui_hud_bombownername]colour] 0 $ui_hud_bar2 $ui_hud_bar2 [uialign -1 1]
                            ] (> $ui_hud_bombdrop 0) [
                                uiimage $bombdroptex $colourcyan 0 $ui_hud_bar2 $ui_hud_bar2 [uialign -1 1]
                            ] () [uiimage $pointtex $ui_hud_bombcol 0 $ui_hud_bar2 $ui_hud_bar2 [uialign -1 1]]
                        ]
                        caseif (>= $ui_hud_bombowner 0) [
                            caseif (= $ui_hud_bombowner $ui_hud_focus) [
                                uitext "HOLDING" $ui_textbig [uitextlimit 1; uitextcolour (getclientrescolour $ui_hud_focus $pulseidxwarn); uialign 0 1]
                            ] (= (getclientteam $ui_hud_bombowner) $ui_hud_team) [
                                uitext "CLAIMED" $ui_textbig [uitextlimit 1; uitextcolour (getclientrescolour $ui_hud_focus $pulseidxbuff); uialign 0 1]
                            ] () [
                                uitext "STOLEN" $ui_textbig [uitextlimit 1; uitextcolour (getclientrescolour $ui_hud_focus $pulseidxwarn); uialign 0 1]
                            ]
                        ] (> $ui_hud_bombdrop 0) [
                            uitext "DROPPED" $ui_textbig [uitextlimit 1; uitextcolour (getclientrescolour $ui_hud_focus $pulseidxdisco); uialign 0 1]
                        ] () [uitext "READY" $ui_textbig [uitextlimit 1; uitextcolour $colourgreen; uialign 0 1]]
                    ]
                ]
            ]
            uispace $ui_padtiny
        ]
    ]
]

ui_hud_raceinventory = [
    if (|| (= $ui_hud_team $teamidxalpha) (! (& (mutators) $mutsbitgsp3))) [
        ui_hud_racetime = (getclientcptime $ui_hud_focus)
        ui_hud_racemillis = (getclientcpmillis $ui_hud_focus)
        ui_hud_racelast = (getclientcplast $ui_hud_focus)
        ui_hud_racepoints = (getclientpoints $ui_hud_focus)
        uivlist 0 [
            uihudskin $ui_hud_sizew $ui_hud_top $ui_hud_colour1 $ui_hud_colour2 [
                uispace $ui_padsmall $ui_padsmall [uitext Laps $ui_text [uitextlimit 1; uialign 0 0]]
            ]
            uihudskin $ui_hud_sizew $ui_hud_sizew $ui_hud_colour1 $ui_hud_colour2 [
                uispace $ui_padsmall $ui_padsmall [uitext $ui_hud_racepoints $ui_textlarge [uitextlimit 1; uialign 0 0]]
            ]
        ]
        uispace $ui_padtiny
        uivlist 0 [
            uihudskin $ui_hud_sizeh $ui_hud_top $ui_hud_colour1 $ui_hud_colour2 [
                uispace $ui_padsmall $ui_padsmall [uitext Current $ui_text [uitextlimit 1; uialign 0 0]]
            ]
            uihudskin $ui_hud_sizeh $ui_hud_sizew $ui_hud_colour1 $ui_hud_colour2 [
                uispace $ui_padsmall $ui_padsmall [uitext (timestr $ui_hud_racemillis $scoreracestyle) $ui_textlarge [uitextlimit 1; uialign 0 0]]
            ]
        ]
        uispace $ui_padtiny
        uivlist 0 [
            uihudskin $ui_hud_sizeh $ui_hud_top $ui_hud_colour1 $ui_hud_colour2 [
                uispace $ui_padsmall $ui_padsmall [uitext Best $ui_text [uitextlimit 1; uialign 0 0]]
            ]
            uihudskin $ui_hud_sizeh $ui_hud_sizew $ui_hud_colour1 $ui_hud_colour2 [
                uispace $ui_padsmall $ui_padsmall [uitext (timestr $ui_hud_racetime $scoreracestyle) $ui_textlarge [uitextlimit 1; uialign 0 0]]
            ]
        ]
        uispace $ui_padtiny
        uivlist 0 [
            uihudskin $ui_hud_sizeh $ui_hud_top $ui_hud_colour1 $ui_hud_colour2 [
                uispace $ui_padsmall $ui_padsmall [uitext Last $ui_text [uitextlimit 1; uialign 0 0]]
            ]
            uihudskin $ui_hud_sizeh $ui_hud_sizew $ui_hud_colour1 $ui_hud_colour2 [
                uispace $ui_padsmall $ui_padsmall [uitext (timestr $ui_hud_racelast $scoreracestyle) $ui_textlarge [uitextlimit 1; uialign 0 0]]
            ]
        ]
        uispace $ui_padtiny
    ]
]

ui_hud_leftinventory = [
    uivlist 0 [
        uialign -1 1
        if $showconsole [ui_hud_chatconsole]
        uispace 0 $ui_padtiny
        uihlist 0 [
            uialign -1 1
            case (gamemode) $modeidxcapture [
                ui_hud_captureinventory
            ] $modeidxdefend [
                ui_hud_defendinventory
            ] $modeidxbomber [
                ui_hud_bomberinventory
            ] $modeidxrace [
                if (= $ui_hud_state 0) [ui_hud_raceinventory]
            ]
        ]
    ]
]

ui_hud_showfps = [
    uihudskin $ui_hud_sizew 0 $ui_hud_colour1 $ui_hud_colour2 [
        uispace $ui_padtiny $ui_padtiny [
            uivlist 0 [
                doif (>= $showfps 1) [
                    uitext (concat (getenginestat 12) "fps") $ui_text [uitextlimit 1]
                ] (>= $showfps 2) [
                    uitext (concatword "+" (getenginestat 13) "-" (getenginestat 14)) $ui_textsmall [uitextlimit 1]
                ]
            ]
        ]
    ]
    uispace 0 $ui_padtiny
]

ui_hud_velocity = [
    uihudskin $ui_hud_sizew 0 $ui_hud_colour1 $ui_hud_colour2 [
        uispace $ui_padtiny $ui_padtiny [
            uivlist 0 [
                uitext "SPEED" $ui_text [uitextlimit 1; uitextcolour $colourgreen]
                uitext (getenginestat 22) $ui_textlarge [uitextlimit 1]
            ]
        ]
    ]
    uispace 0 $ui_padtiny
]

ui_hud_impulsebar = [
    if (getclientallowimpulse $ui_hud_focus) [
        uihudskin $ui_hud_sizew $ui_hud_bar $ui_hud_colour1 $ui_hud_colour2 [
            uivlist 0 [
                uialign 0 1
                ui_hud_impulse = (getclientimpulsemeter $ui_hud_focus)
                ui_hud_impulseregen = (getclientimpulseregen $ui_hud_focus)
                ui_hud_impulseamt = 100
                ui_hud_impulsepart = 1.0
                ui_hud_impulseclip = 0
                if (> $ui_hud_impulse 0) [
                    ui_hud_impulsepart = (-f 1 (divf $ui_hud_impulse $impulsemeter))
                    ui_hud_iprtm = (clampf $ui_hud_impulsepart 0.0 1.0)
                    ui_hud_impulseclip = (*f $ui_hud_barh $ui_hud_iprtm)
                    ui_hud_impulseamt = (ceil (*f $ui_hud_iprtm 100))
                ]
                if (>f $ui_hud_impulsepart 0) [
                    uiclip 0 $ui_hud_impulseclip 0 (-f $ui_hud_barh $ui_hud_impulseclip) [
                        uialign 0 1
                        uiimagevgradient "<grey><rotate:4>textures/barskin" $colourpurple $colourcyan 0 $ui_hud_barw $ui_hud_barh [
                            uialign 0 1
                            uicolouradd $colourblue
                            if $ui_hud_impulseregen [
                                uicolourrotate (divf $ui_hud_impulseregen 1000)
                            ]
                        ]
                    ]
                ] [uifill $ui_hud_barw $ui_hud_barh]
                if (<=f $ui_hud_impulsepart 0.25) [
                    uitext $ui_hud_impulseamt $ui_textlarge [uitextlimit 1; uitextcolour (getclientrescolour $ui_hud_focus $pulseidxwarn); uialign 0 1]
                ] [uitext $ui_hud_impulseamt $ui_textlarge [uitextlimit 1; uialign 0 1]]
            ]
        ]
    ]
]

ui_hud_rightbar = [
    if $showfps [ui_hud_showfps]
    if (= $ui_hud_state 0) [
        if $showvelocity [ui_hud_velocity]
        ui_hud_impulsebar
    ]
]

ui_hud_weaponinventory = [
    ui_hud_weapselect = (getclientweapselect $ui_hud_focus)
    loopinventoryrev $ui_hud_focus 0 0 ui_hud_weapon [
        ui_hud_weapidx = (at $weapname $ui_hud_weapon)
        ui_hud_weapstate = (getclientweapstate $ui_hud_focus $ui_hud_weapon)
        ui_hud_weapload = (? (|| (= $ui_hud_weapstate 3) (= $ui_hud_weapstate 5)) (getclientweapload $ui_hud_focus $ui_hud_weapon) 0)
        ui_hud_weapammo = (getclientweapammo $ui_hud_focus $ui_hud_weapon)
        ui_hud_weapmax = $[@[ui_hud_weapidx]ammomax]
        ui_hud_weapcol = $[@[ui_hud_weapidx]colour]
        ui_hud_weapcol1 = (modcolour $ui_hud_weapcol 0.75)
        ui_hud_weapcol2 = (modcolour $ui_hud_weapcol 0.5)
        ui_hud_weapclip = 0.0
        ui_hud_weappart = 1.0
        if (|| (<= $ui_hud_weapammo 0) $ui_hud_weapload) [
            ui_hud_weapammo = (? $ui_hud_weapload (- $ui_hud_weapammo $ui_hud_weapload) 0)
        ]
        ui_hud_weappart = (divf $ui_hud_weapammo $ui_hud_weapmax)
        if (<f $ui_hud_weappart 1.0) [ui_hud_weapclip = (*f $ui_hud_mtrw (clampf $ui_hud_weappart 0.0 1.0))]
        uivlist 0 [
            uihudskin $ui_hud_sizew $ui_hud_top (? (= $ui_hud_weapselect $ui_hud_weapon) $ui_hud_colour3 $ui_hud_colour1) $ui_hud_colour2 [
                if (>f $ui_hud_weappart 0) [
                    uifill $ui_hud_mtrw $ui_hud_mtrh [
                        uialign 0 0
                        uiclip $ui_hud_weapclip $ui_hud_mtrh 0 0 [
                            uialign -1 0
                            uiimagehgradient "<grey><rotate:1>textures/meterskin" $ui_hud_weapcol2 $ui_hud_weapcol1 0 $ui_hud_mtrw $ui_hud_mtrh [
                                uialign -1 0
                                uicolouradd $ui_hud_weapcol
                            ]
                        ]
                    ]
                ]
            ]
            uispace 0 $ui_padtiny
            uihudskin $ui_hud_sizew $ui_hud_sizew (? (= $ui_hud_weapselect $ui_hud_weapon) $ui_hud_colour3 $ui_hud_colour1) $ui_hud_colour2 [
                uivlist 0 [
                    uialign 0 -1
                    uiimage $[@[ui_hud_weapidx]tex] $ui_hud_weapcol 0 $ui_hud_barw $ui_hud_barw [uialign 0 0]
                    caseif (< $ui_hud_weapammo 0) [
                        uitext "-" $ui_textbig [uitextlimit 1; uitextcolour (getclientrescolour $ui_hud_focus $pulseidxwarn); uialign 0 1]
                    ] (<=f $ui_hud_weappart 0.25) [
                        uitext $ui_hud_weapammo $ui_textbig [uitextlimit 1; uitextcolour (getclientrescolour $ui_hud_focus $pulseidxwarn); uialign 0 1]
                    ] $ui_hud_weapload [
                        uitext $ui_hud_weapammo $ui_textbig [uitextlimit 1; uitextcolour (getclientrescolour $ui_hud_focus $pulseidxbuff); uialign 0 1]
                    ] () [uitext $ui_hud_weapammo $ui_textbig [uitextlimit 1; uialign 0 1]]
                ]
            ]
        ]
        uispace $ui_padtiny
    ]
]

ui_hud_rightinventory = [
    if (= $ui_hud_state 0) [ui_hud_weaponinventory]
]

ui_hud_statenames = [ALIVE DEAD EDIT SPEC WAIT]
ui_hud_statetexs = [playertex deadtex editingtex spectatortex waitingtex]
ui_hud_statetex2 = [playerbliptex deadtex playerbliptex spectatortex deadtex]

ui_hud_statebar = [
    ui_hud_statename = (at $ui_hud_statenames $arg1)
    ui_hud_statetex = $[@(at $ui_hud_statetexs $arg1)]
    ui_hud_statecolour = $ui_default
    if (= $arg1 0) [
        if (= $ui_hud_team $teamidxneutral) [ui_hud_statetex = $playertex] [ui_hud_statetex = $[team@(at $teamnames $ui_hud_team)tex]]
        ui_hud_statename = $[team@(at $teamnames $ui_hud_team)name]
        ui_hud_statecolour = $[team@(at $teamnames $ui_hud_team)colour]
    ]
    uihudskin $ui_hud_sizew $ui_hud_sizew $ui_hud_colour1 $ui_hud_colour2 [
        uispace 0 $ui_padsmall [
            uialign 0 -1
            uiimage $ui_hud_statetex $ui_hud_statecolour 0 $ui_hud_barw $ui_hud_barw [uialign 0 -1]
        ]
        uitext $ui_hud_statename $ui_textbig [uitextlimit 1; uitextcolour $ui_hud_statecolour; uialign 0 1]
    ]
    uispace 0 $ui_padtiny
]

ui_hud_timecols = [red red red red red green yellow orange orange]

ui_hud_timestate = [
    uihudskin $ui_hud_sizew $ui_hud_sizew $ui_hud_colour1 $ui_hud_colour2 [
        uispace $ui_padsmall $ui_padsmall [
            uivlist 0 [
                caseif $gamepaused [
                    uitext Paused $ui_textlarge [uitextlimit 1; uitextcolour $colourorange; uialign 0 0]
                ] (= (gamemode) $modeidxediting) [
                    uitext Editing $ui_textlarge [uitextlimit 1; uitextcolour $colourgreen; uialign 0 0]
                ] () [
                    ui_hud_timeremain = (getgametimeremain) 
                    ui_hud_timecolour = (at $ui_hud_timecols (getgamestate))
                    if (getgametimelimit) [
                        uitext (getgamestatestr 1) $ui_text [uitextlimit 1; uitextcolour $[colour@[ui_hud_timecolour]]; uialign 0 0]
                        uitext (timestr $ui_hud_timeremain $showtimestyle) $ui_textlarge [uitextlimit 1; uitextcolour (? (|| (!= (getgamestate) 5) (< $ui_hud_timeremain 60000)) (getclientrescolour $ui_hud_focus $pulseidxwarn) $colourwhite); uialign 0 0]
                    ] [
                        uitext (getgamestatestr 1) $ui_textlarge [uitextlimit 1; uitextcolour $[colour@[ui_hud_timecolour]]; uialign 0 0]
                    ]
                ]
            ]
        ]
    ] [uialign 1 -1]
]

// 1:dist 2:offset 3:border 4:w 5:h 6:blip 7:smallblip 8:playernames 9:distblend
ui_hud_radar = [
    uiradar $arg1 $arg2 $arg3 $arg4 $arg5 [
        if (! (& (mutators) $mutsbithard)) [
            loopclients 0 0 ui_hud_radarclient [
                if (!= $ui_hud_radarclient $ui_hud_focus) [
                    ui_hud_radarclientdir = (getclientradardir $ui_hud_radarclient)
                    if (!=s $ui_hud_radarclientdir "") [
                        ui_hud_radarclientyaw = (getclientradaryaw $ui_hud_radarclient)
                        ui_hud_radarclientvel = (getclientvelocity $ui_hud_radarclient)
                        ui_hud_radarclientdist = (getclientradardist $ui_hud_radarclient)
                        ui_hud_radarclientstate = (getclientstate $ui_hud_radarclient)
                        ui_hud_radarclientdominated = (&& (= $ui_hud_radarclientstate 0) (getclientisdominated $ui_hud_radarclient $ui_hud_focus))
                        ui_hud_radarclientpcolour = (getclientcolour $ui_hud_radarclient -1 2)
                        if $ui_hud_radarclientdominated [
                            ui_hud_radarclientcolour = (getclientrescolour $ui_hud_focus $pulseidxdisco)
                            uiradarblip $playerbliptex (| 0x80000000 $ui_hud_radarclientpcolour) $ui_hud_radarclientdir $ui_hud_radarclientyaw $ui_hud_radarclientdist $arg6 $arg6 [
                                uiimage $dominatedtex $ui_hud_radarclientcolour 0 $arg6 $arg6
                                if $arg8 [uivlist 0 [uispace 0 $arg7; uitext (getclientname $ui_hud_radarclient 0 0) $ui_textradar [uitextcolour $ui_hud_radarclientcolour]]]
                            ]
                        ] [
                            ui_hud_radarclientblend = (? (= $ui_hud_radarclientstate 0) (clamp (*f (divf $ui_hud_radarclientvel $movespeed) 255) 0 255) 160)
                            if $ui_hud_radarclientblend [
                                if (>f $arg9 0) [
                                    if (>f $ui_hud_radarclientdist $arg9) [
                                        ui_hud_radarclientblend = 0
                                    ] [
                                        ui_hud_radarclientblend = (clamp (*f $ui_hud_radarclientblend (-f 1 (divf $ui_hud_radarclientdist $arg9))) 1 255)
                                    ]
                                ]
                                if $ui_hud_radarclientblend [
                                    ui_hud_radarclientteam = (getclientteam $ui_hud_radarclient)
                                    ui_hud_radarclienttcolour = $[team@(at $teamnames $ui_hud_radarclientteam)colour]
                                    ui_hud_radarclientblend2 = (clamp (*f $ui_hud_radarclientblend 0.65) 1 255)
                                    doif (getclientburning $ui_hud_radarclient) [
                                        ui_hud_radarclientpcolour = (getclientrescolour $ui_hud_radarclient $pulseidxburn)
                                    ] (getclientbleeding $ui_hud_radarclient) [
                                        ui_hud_radarclientpcolour = (getclientrescolour $ui_hud_radarclient $pulseidxbleed)
                                    ] (getclientshocking $ui_hud_radarclient) [
                                        ui_hud_radarclientpcolour = (getclientrescolour $ui_hud_radarclient $pulseidxshock)
                                    ] (getclientbuffing $ui_hud_radarclient) [
                                        ui_hud_radarclientpcolour = (getclientrescolour $ui_hud_radarclient $pulseidxbuff)
                                    ]
                                    uiradarblip $[@(at $ui_hud_statetex2 $ui_hud_radarclientstate)] (? (= $ui_hud_radarclientstate 0) (| (<< $ui_hud_radarclientblend2 24) $ui_hud_radarclientpcolour) (| (<< $ui_hud_radarclientblend 24) $ui_hud_radarclienttcolour)) $ui_hud_radarclientdir (? (= $ui_hud_radarclientstate 0) $ui_hud_radarclientyaw $ui_hud_radarclientdir) $ui_hud_radarclientdist $arg6 $arg6 [
                                        if (= $ui_hud_radarclientstate 0) [uiimage $bliptex (| (<< $ui_hud_radarclientblend 24) $ui_hud_radarclienttcolour) 0 $arg7 $arg7]
                                        if $arg8 [uivlist 0 [uispace 0 $arg7; uitext (getclientname $ui_hud_radarclient 0 0) $ui_textradar [uitextcolour (| (<< $ui_hud_radarclientblend 24) $ui_hud_radarclienttcolour)]]]
                                    ]
                                ]
                            ]
                        ]
                    ]
                ]
            ]
        ]
        if (|| $radarhardaffinity (! (& (mutators) $mutsbithard))) [
            case (gamemode) $modeidxcapture [
                loopcapture 0 0 ui_hud_radarcapture [
                    ui_hud_radarcapturedir = (getcaptureradardir $ui_hud_radarcapture)
                    if (!=s $ui_hud_radarcapturedir "") [
                        ui_hud_radarcapturedist = (getcaptureradardist $ui_hud_radarcapture)
                        ui_hud_radarcaptureteam = (getcaptureteam $ui_hud_radarcapture)
                        ui_hud_radarcapturetcolour = $[team@(at $teamnames $ui_hud_radarcaptureteam)colour]
                        ui_hud_radarcaptureowner = (getcaptureowner $ui_hud_radarcapture)
                        ui_hud_radarcapturedrop = (getcapturedroptime $ui_hud_radarcapture)
                        ui_hud_radarcapturetex = ""
                        doif (&& ui_hud_carryaffinity (= $ui_hud_radarcaptureteam $ui_hud_team)) [
                            if (|| (< $ui_hud_radarcaptureowner 0) (= $ui_hud_radarcaptureowner $ui_hud_focus)) [
                                ui_hud_radarcapturedir = (getcaptureradardir $ui_hud_radarcapture 1)
                                ui_hud_radarcapturedist = (getcaptureradardist $ui_hud_radarcapture 1)
                            ]
                            ui_hud_radarcapturetcolour = (getclientrescolour $ui_hud_focus $pulseidxdisco)
                            ui_hud_radarcapturetex = $arrowtex
                        ] (|| $ui_hud_radarcapturedrop (&& (>= $ui_hud_radarcaptureowner 0) (= $ui_hud_radarcaptureteam $ui_hud_team) (!= $ui_hud_radarcaptureowner $ui_hud_focus))) [
                            ui_hud_radarcapturetex = $flagtex
                            ui_hud_radarcapturetcolour = (getclientrescolour $ui_hud_focus $pulseidxdisco)
                        ] (!= $ui_hud_radarcaptureowner $ui_hud_focus) [
                            ui_hud_radarcapturetex = $flagtex
                        ]
                        if (!=s $ui_hud_radarcapturetex "") [
                            uiradarblip $ui_hud_radarcapturetex $ui_hud_radarcapturetcolour $ui_hud_radarcapturedir $ui_hud_radarcapturedir $ui_hud_radarcapturedist (*f $arg6 1.5) (*f $arg6 1.5) [
                                if (>= $ui_hud_radarcaptureowner 0) [uialign 0 1]
                                uivlist 0 [uispace 0 (*f $arg7 1.5); uitext $[team@(at $teamnames $ui_hud_radarcaptureteam)name] $ui_textradar [uitextcolour (| $ui_transor $ui_hud_radarcapturetcolour)]]
                            ]
                        ]
                    ]
                ]
            ] $modeidxdefend [
                loopdefend 0 0 ui_hud_radardefend [
                    ui_hud_radardefenddir = (getdefendradardir $ui_hud_radardefend)
                    if (!=s $ui_hud_radardefenddir "") [
                        ui_hud_radardefenddist = (getdefendradardist $ui_hud_radardefend)
                        ui_hud_radardefendteam = (getdefendowner $ui_hud_radardefend)
                        ui_hud_radardefendtcolour = $[team@(at $teamnames $ui_hud_radardefendteam)colour]
                        ui_hud_radardefendname = (getdefendname $ui_hud_radardefend)
                        uiradarblip $pointtex $ui_hud_radardefendtcolour $ui_hud_radardefenddir $ui_hud_radardefenddir $ui_hud_radardefenddist (*f $arg6 1.5) (*f $arg6 1.5) [
                            uivlist 0 [uispace 0 (*f $arg7 2); uitext $ui_hud_radardefendname $ui_textradar [uialign 0 1; uitextwrap 0.04; uitextcolour (| $ui_transor $ui_hud_radardefendtcolour)]]
                        ]
                    ]
                ]
            ] $modeidxbomber [
                loopbomber 0 0 ui_hud_radarbomber [
                    if (getbomberenabled $ui_hud_radarbomber) [
                        ui_hud_radarbomberdir = (getbomberradardir $ui_hud_radarbomber)
                        if (!=s $ui_hud_radarbomberdir "") [
                            ui_hud_radarbomberteam = (getbomberteam $ui_hud_radarbomber)
                            ui_hud_radarbomberowner = (getbomberowner $ui_hud_radarbomber)
                            ui_hud_radarbombertex = ""
                            ui_hud_radarbombername = ""
                            doif (!= $ui_hud_radarbomberteam $teamidxneutral) [
                                if (&& ui_hud_carryaffinity (!= $ui_hud_radarbomberteam $ui_hud_team)) [
                                    ui_hud_radarbombertex = $arrowtex
                                    ui_hud_radarbombername = "Destroy"
                                ]
                            ] (&& (= $ui_hud_radarbomberteam $teamidxneutral) (!= $ui_hud_radarbomberowner $ui_hud_focus)) [
                                ui_hud_radarbombertex = $bombtex
                                ui_hud_radarbombername = "Bomb"
                            ]
                            if (!=s $ui_hud_radarbombertex "") [
                                ui_hud_radarbomberdist = (getbomberradardist $ui_hud_radarbomber)
                                uiradarblip $ui_hud_radarbombertex (getclientrescolour $ui_hud_focus $pulseidxdisco) $ui_hud_radarbomberdir $ui_hud_radarbomberdir $ui_hud_radarbomberdist (*f $arg6 1.5) (*f $arg6 1.5) [
                                    if (>= $ui_hud_radarbomberowner 0) [uialign 0 1]
                                    if (!=s $ui_hud_radarbombername "") [uivlist 0 [uispace 0 (*f $arg7 1.5); uitext $ui_hud_radarbombername $ui_textradar [uitextcolour (| $ui_transor (getclientrescolour $ui_hud_focus $pulseidxdisco))]]]
                                ]
                            ]
                        ]
                    ]
                ]
            ]
        ]
    ]
]

ui_hud_minimap = [
    uispace $ui_padtiny
    uihudskin $ui_hud_sizeh $ui_hud_sizeh $ui_hud_colour1 $ui_hud_colour2 [
        uispace $ui_padtiny $ui_padtiny [
            uiminimap "<grey>textures/hud/radar" $ui_hud_colour $minimapdist 0.1 $ui_hud_sizeh $ui_hud_sizeh [
                ui_hud_radar $minimapdist $minimapoffset $minimapborder $ui_hud_sizeh $ui_hud_sizeh $minimapblipsize $minimapsmallblipsize $minimapplayernames $minimapdistblend
            ]
        ]
    ] [uialign 1 -1]
]

ui_hud_midradar = [
    if (= $ui_hud_state 0) [
        ui_hud_radar $radardist $radaroffset 0 $radarsizew $radarsizeh $radarblipsize $radarsmallblipsize $radarplayernames $radardistblend
    ]
]

ui_hud_righttop = [
    uivlist 0 [
        if (!= $ui_hud_focus $ui_hud_clientnum) [ui_hud_statebar (getclientstate $ui_hud_clientnum)] [ui_hud_statebar $ui_hud_state]
        ui_hud_timestate
    ]
    if $showminimap [ui_hud_minimap]
]

ui_hud_lefttop = [
    if $showconsole [ui_hud_showconsole]
]

newui "hud" [
    ui_hud_init
    uiallowinput 0
    uiclamp 1 1 1 1
    caseif (getprogressing) [
        ui_hud_progresstype = (getprogresstype)
        if $ui_hud_progresstype [
            uiexclusive 1
            uiblurskin 0 0 $ui_menu_a [
                uispace $ui_padwin $ui_padwin [
                    uivlist 0 [
                        ui_hud_progressmap = (&& $ui_hud_progresstype (!=s $mapname ""))
                        uitext (? $ui_hud_progressmap (getmaptitle $mapname) "Loading") $ui_textlarge
                        uitext (? $ui_hud_progressmap (concat "by" (getmapauthor $mapname)) "Please Wait") $ui_textbig
                        uispace 0 $ui_padbutton
                        if (&& $ui_hud_progresstype (isconnected)) [
                            if (= $ui_hud_progresstype 2) [
                                uitext "^fs^fyLightmapping^fS" $ui_text
                            ] [
                                gname = (gamename (gamemode) (mutators) 0 32)
                                uitext (format "^fs^fy%1^fS" $gname) $ui_text
                            ]
                        ]
                        case $ui_hud_progresstype 2 [] 1 [
                            if (isconnected) [
                                ui_loading_modetexs = (modetexlist (gamemode) (mutators))
                                looplist ui_loading_modetex $ui_loading_modetexs [uiimage $ui_loading_modetex $ui_default 0 $ui_imgbut $ui_imgbut]
                                uitext (modedesc (gamemode) (mutators) 5) $ui_textsmall
                                if (> (mutators) 0) [
                                    loop i $mutsidxnum [
                                        ui_loading_mut = (<< 1 $i)
                                        if (&& [& (mutators) $ui_loading_mut] [! (& (mutsimplied (gamemode)) $ui_loading_mut)]) [
                                            ui_loading_muttxt = (mutsdesc (gamemode) $ui_loading_mut 4)
                                            if (!=s $ui_loading_muttxt "") [uitext (concatword "^fa" $ui_loading_muttxt) $ui_textsmall]
                                        ]
                                    ]
                                ]
                                uispace 0 $ui_padbutton
                                if (!=s $connectname "") [
                                    uitext (format "^faOn: ^fw%1:[%2]" $connectname $connectport) $ui_textsmall
                                    if (&& (isconnected) (!=s $serverdesc "")) [uitext (format "^"^fs%1^fS^"" $serverdesc) $ui_textsmall]
                                ] [uitext (format "^faPlaying Offline" $connectname $connectport) $ui_textsmall]
                            ]
                        ]
                    ]
                ]
            ]
            uispace $ui_padwin $ui_padwin [
                uialign 0 1
                uioffset 0 -0.35 [
                    uiblurskin 0 0 $ui_menu_a [
                        uispace $ui_padwin $ui_padnormal [uitext (tipshow) $ui_textstatus]
                    ]
                ]
            ]
        ] [uiexclusive 0]
        ui_loading_title = (getprogresstitle)
        if (!=s $ui_loading_title "") [
            uispace $ui_padwin $ui_padwin [
                uialign -1 1
                uihlist 0 [
                    uialign -1 1
                    uiblurskin 0 0 $ui_menu_a [
                        uispace $ui_padsmall $ui_padtiny [
                            uifill $ui_buttonzs $ui_buttonzh [
                                uialign 0 0
                                uiclip (*f $ui_buttonzs $progressamt) 0 0 0 [
                                    uialign -1 0
                                    uiimagehgradient "<grey><rotate:1>textures/meterskin" $colourred $colourdarkred 0 $ui_buttonzs $ui_buttonzh [
                                        uialign -1 0
                                        uicolouradd $colourpink
                                    ]
                                ]
                            ]
                        ]
                    ]
                    uispace $ui_padsmall
                    uitext $ui_loading_title $ui_text [uitextalign -1; uialign -1 0]
                ]
            ]
        ]
    ] $ui_hud_showhud [
        uiexclusive $ui_hud_commandopen
        if (isconnected) [
            uispace $ui_padwin $ui_padwin [
                uialign 1 -1
                uihlist 0 [
                    uialign 1 -1
                    uihlist 0 [
                        uialign 1 -1
                        ui_hud_righttop
                    ]
                ]
            ]
            uispace $ui_padwin $ui_padwin [
                uialign -1 1
                uihlist 0 [
                    uialign -1 1
                    uivlist 0 [
                        uialign -1 1
                        ui_hud_leftbar
                    ]
                    uispace $ui_padtiny
                    uihlist 0 [
                        uialign -1 1
                        ui_hud_leftinventory
                    ]
                ]
            ]
            uispace $ui_padwin $ui_padwin [
                uialign 1 1
                uihlist 0 [
                    uialign 1 1
                    uihlist 0 [
                        uialign 1 1
                        ui_hud_rightinventory
                    ]
                    uivlist 0 [
                        uialign 1 1
                        ui_hud_rightbar
                    ]
                ]
            ]
            uispace $ui_padtiny $ui_padtiny [
                ui_hud_midradar
            ]
        ]
        uispace $ui_padwin $ui_padwin [
            uialign -1 -1
            uihlist 0 [
                uialign -1 -1
                uihlist 0 [
                    uialign -1 -1
                    ui_hud_lefttop
                ]
            ]
        ]
    ] [uiexclusive 0]
] [] [] 16

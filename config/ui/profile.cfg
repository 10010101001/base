profilebuttons = [
    guilist [ guifont "emphasis" [
        guistrut 2
        guibutton "^fgok" [
            setinfo $playerprevname $playerprevcolour $playerprevmodel $playerprevvanity $playerprevloadweap $playerprevrandweap
            cleargui 1
        ] []
        guistrut 3
        if (needname) [
            guibutton "^fomain menu" [showgui main]
        ] [
            guibutton "^focancel" [cleargui 1]
        ]
    ] ]
]

playerprevinherit = 0
playerprevdisinherit = 0

loadweapall = 0
loadweaps = [
    lwa = ""
    lwl = (listlen $playerprevloadweap)
    lwo = (? (> $lwl $arg1) (at $playerprevloadweap $arg1) -1)
    loop lw2 $weapidxloadout [
        if (= $lw2 $arg1) [
            lwa = (? $lw2 (concat $lwa $arg2) $arg2)
        ] [
            lw3 = (? (> $lwl $lw2) (at $playerprevloadweap $lw2) -1)
            if (&& $lw3 (= $arg2 $lw3)) [ lw3 = $lwo ]
            lwa = (? $lw2 (concat $lwa $lw3) $lw3)
        ]
    ]
    if (listlen $lwa) [ playerprevloadweap = $lwa ]
    playerprevweap = $arg2
]

randweaps = [
    rwa = ""
    rwl = (listlen $playerprevrandweap)
    loop rw2 $weapidxloadout [
        rw3 = (> $rwl $rw2)
        rwv = (? $rw3 (at $playerprevrandweap $rw2) 1)
        if (= $rw2 $arg1) [
            rwv = $arg2
        ]
        rwa = (? $rw2 (concat $rwa $rwv) $rwv)
    ]
    if (listlen $rwa) [ playerprevrandweap = $rwa ]
]

// these names should match the types in config/vanities.cfg
vantypename = [chest eyes scalp forehead ears face back [right foot] [left foot] [right shoulder] [left shoulder]]
vantypesel = -1
vansel = -1

uimenu "welcome" "Welcome to Red Eclipse" [
    uivlist 0.01 [
        uitext "To get ready for action, please set up your player profile!"
        uispace 0 0.01
        uitext "Use the other tabs of this menu to choose a name, a profile colour and a pair of loadout weapons." 0.8
        uitext "To learn more about the weapons and many other aspects of the game, you can consult the help menus." 0.8
        uispace 0 0.01
        uitext (format "You can press %1 any time to open these menus, and %2 to return to the previous menu." (dobindsearch [showgui help]) (dobindsearch [if (cleargui 1) [] [showgui main]]))
        uispace 0 0.01
        uitext "During a match, this allows you to quickly look up rules and tips for the current game mode." 0.8
        uitext "Most of this information is also available on the Red Eclipse wiki, ^fchttp://redeclipse.net/wiki/" 0.8
        uitext "Once you have set up your profile with the ^fgok^fw button, you can start playing offline or online." 0.8
        uitext "Learning by doing or watching experienced players, both are great ways to get you started." 0.8
        uispace 0 0.01
        uitext (format "You can press %1 to enter spectator mode and %2 to toggle first or third person view." (dobindsearch [spectate 1]) (dobindsearch thirdpersonswitch))
        uispace 0 0.01
        uitext "Use the mouse wheel to follow the view of different players while spectating." 0.8
        uispace 0 0.01
        uitext (format "One last tip: You can perform wall-runs and kicks with the %1 key. Have fun!" (dobindsearch special))
    ]
]

uimenu "profile" "Player Profile Setup" [
    uihlist 0.01 [
        uivlist $uibutton_padding [
            uiplayerpreview $playerprevmodel $playerprevcolour $playerprevteam $playerprevweap $playerprevvanity 1 1 0.4 0.5 [
                style_generic_default
                uiclamp* 1 1 1 1
            ]
            uitext (getplayername) 0.6
        ]
        uivlist 0.01 [
            uialign 0 -1
            uihtab 0.2 0.035 c_tab [
                0 "General" []
                1 "Loadout" []
                2 "Vanity Items" []
            ] 1
            uialign- 0 -1
            uispace 0.02
            uitable 0 0.005 [
                case $c_tab 0 [
                    uitablerow [
                        uihlist 0.01 [uitext "Player Name"]
                        uispace 0.01
                        uihlist 0.01 [uiinput playerprevname 24 [] 1 "" "^fzad<enter name>"]
                    ]
                    uitablerow [
                        uivlist 0.01 [
                            uitext "Player Colour"
                            uihexpreview $playerprevcolour "hex-value"
                        ]
                        uispace 0.01
                        uirgbsliders playerprevcolour
                    ]
                ]
            ]
            uialign- 0 -1
        ]
    ]
] [
    if $playerprevdisinherit [ playerprevdisinherit = 0 ] [
        playerprevteam = (getplayerteam 1)
        playerprevweap = (weapselect)
        playerprevname = (getplayername)
        playerprevcolour = (getplayercolour -1)
        playerprevmodel = (getplayermodel)
        playerprevvanity = (getplayervanity)
    ]
    playerprevloadweap = ""
    break = 0
    loopwhile i $weapidxloadout [= $break 0] [
        q = (getloadweap $i)
        if (< $q 0) [ break = 1 ] [ playerprevloadweap = (? $i (concat $playerprevloadweap $q) $q) ]
    ]
    playerprevrandweap = ""
    break = 0
    loopwhile i $weapidxloadout [= $break 0] [
        q = (getrandweap $i)
        playerprevrandweap = (? $i (concat $playerprevrandweap $q) $q)
    ]
    if (needname) [ showui welcome 0 ]
]